{% extends "base.html" %}
{% block title %}Reservar Habitación{% endblock %}
{% block content %}

<section class="py-16 sm:py-24">
  <div class="container mx-auto px-6 max-w-xl">
    <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Reservar habitación</h2>

    <form action="{{ url_for('agregar_reserva') }}" method="POST" class="space-y-6 bg-white dark:bg-gray-900 p-6 rounded-xl shadow-lg">
      <div>
        <label for="fecha_entrada" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Fecha de entrada</label>
        <input type="date" name="fecha_entrada" id="fecha_entrada" required class="w-full px-4 py-2 rounded-lg border bg-gray-50 dark:bg-gray-800">
      </div>

      <div>
        <label for="fecha_salida" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Fecha de salida</label>
        <input type="date" name="fecha_salida" id="fecha_salida" required class="w-full px-4 py-2 rounded-lg border bg-gray-50 dark:bg-gray-800">
      </div>

      <div>
        <label for="habitacion_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Habitación disponible</label>
        <select name="habitacion_id" id="habitacion_id" required class="w-full px-4 py-2 rounded-lg border bg-gray-50 dark:bg-gray-800">
          <option value="">Selecciona fechas primero</option>
        </select>
      </div>

      <button type="submit" class="w-full px-5 py-3 text-sm font-bold bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
        Confirmar reserva
      </button>
    </form>
  </div>
</section>

<script>
document.getElementById('fecha_salida').addEventListener('change', () => {
  const entrada = document.getElementById('fecha_entrada').value;
  const salida = document.getElementById('fecha_salida').value;

  if (entrada && salida) {
    fetch('/habitaciones_disponibles', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: `fecha_entrada=${entrada}&fecha_salida=${salida}`
    })
    .then(response => response.json())
    .then(data => {
      const select = document.getElementById('habitacion_id');
      select.innerHTML = '';

      if (data.length === 0) {
        select.innerHTML = '<option value="">No hay habitaciones disponibles</option>';
      } else {
        data.forEach(h => {
          const option = document.createElement('option');
          option.value = h.id;
          option.textContent = `Habitación ${h.numero} - ${h.nombre} (${h.tipo}) - ${h.precio}€`;
          select.appendChild(option);
        });
      }
    });
  }
});
</script>

{% endblock %}
